
<!doctype html><html lang="es"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quiz â€” FotosÃ­ntesis</title><link rel="stylesheet" href="../css/style.css"/>
<script type="module">
import {saveJSON, loadJSON, ts, toCSV, download, sendMail} from "../js/utils.js";
import {initGlobalUI, studentFieldsHTML, getStudent, sendEmailWithAttachment} from "../js/app.js";

const preguntas = [
  {q:"Â¿En quÃ© orgÃ¡nulo ocurre principalmente la fotosÃ­ntesis?", opts:["Mitocondria","Cloroplasto","Aparato de Golgi","Lisosoma"], a:1},
  {q:"Â¿QuÃ© gas ingresa a la planta para producir glucosa?", opts:["OxÃ­geno","HidrÃ³geno","DiÃ³xido de carbono (COâ‚‚)","NitrÃ³geno"], a:2},
  {q:"Â¿CuÃ¡l es el producto principal de la fase oscura (Ciclo de Calvin)?", opts:["ATP","NADPH","OxÃ­geno","Glucosa"], a:3}
];

function render(){
  const wrap = document.querySelector("#quiz");
  wrap.innerHTML = "";
  preguntas.forEach((p,i)=>{
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<p><b>${i+1}.</b> ${p.q}</p>` +
      p.opts.map((o,j)=>`<label class="toggle"><input type="radio" name="q${i}" value="${j}"> ${o}</label>`).join("<br/>");
    wrap.appendChild(div);
  });
}

function calificar(){
  let correctas = 0;
  preguntas.forEach((p,i)=>{
    const v = document.querySelector(`input[name='q${i}']:checked`);
    if(v && Number(v.value)===p.a) correctas++;
  });
  return {total:preguntas.length, correctas, pct: Math.round(100*correctas/preguntas.length)};
}

function guardar(){
  const alumno = getStudent();
  const r = calificar();
  const data = loadJSON("quiz_data",{registros:[]});
  data.registros.push({ts:ts(), ...r, alumno});
  saveJSON("quiz_data", data);
  alert(`Resultado: ${r.correctas}/${r.total} (${r.pct}%)`);
}

function exportCSV(){
  const data = loadJSON("quiz_data",{registros:[]});
  const csv = toCSV(data.registros);
  download(`quiz_${Date.now()}.csv`, csv);
}

async function mail(){
  const data = loadJSON("quiz_data",{registros:[]});
  const ultimo = data.registros[data.registros.length-1] || {};
  try{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text('Quiz â€” Proyecto X',10,10);
    doc.text(JSON.stringify(ultimo).substring(0,1000),10,18);
    const pdf = doc.output('datauristring');
    await sendEmailWithAttachment('[Piloto] Quiz â€” FotosÃ­ntesis', JSON.stringify(ultimo,null,2), pdf);
    alert('Enviado con EmailJS');
  }catch(e){ console.error(e); alert('Error al enviar con EmailJS'); }
}

window.addEventListener("DOMContentLoaded", ()=>{
  initGlobalUI();
  document.getElementById('studentFields').innerHTML = studentFieldsHTML();
  render();
  document.querySelector("#btnSave").addEventListener("click", guardar);
  document.querySelector("#btnCSV").addEventListener("click", exportCSV);
  document.querySelector("#btnMail").addEventListener("click", mail);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script></head>
<body>
<header><div class="container"><a href="../index.html" class="btn ghost">â¬…ï¸ Volver</a> <div style="margin-left:auto" class="toolbar"><button class="btn secondary" id="btnHighContrast">â¬› Alto contraste</button><button class="btn ghost" id="btnNarrator"><span>Narrador: OFF</span></button></div> <strong style="margin-left:12px">Quiz Â· FotosÃ­ntesis</strong></div></header>
<main class="container">
  <div class="toolbar"><script type="module">import {initGlobalUI,studentFieldsHTML,getStudent,sendEmailWithAttachment} from "../js/app.js";</script>
    <button class="btn" id="btnSave">âœ… Guardar</button>
    <button class="btn secondary" id="btnCSV">âœ… CSV</button>
    <button class="btn ghost" id="btnMail">âœ‰ï¸ Enviar</button>
  </div>
  <div class="card" id="alumno_box"><h3>ğŸ‘¤ Datos del estudiante</h3><div id="studentFields"></div></div>
<div id="quiz"></div>
</main>
 <footer class="footer">
  <div>ğŸ“š<strong>Â© Neotech EduLab â€” EducaciÃ³n Inmersiva </strong></div>
  <div>ğŸ› ï¸Prohibida su copia y/o reproduccion</div>
  </footer>
</body></html>
